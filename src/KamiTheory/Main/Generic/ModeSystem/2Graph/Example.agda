
{-# OPTIONS --allow-unsolved-metas --rewriting #-}

module KamiTheory.Main.Generic.ModeSystem.2Graph.Example where

open import Agora.Conventions
open import Agora.Order.Preorder
open import KamiTheory.Basics

open import KamiTheory.Main.Generic.ModeSystem.2Graph.Definition


module SendReceiveNarrow-2Graph (P : Preorder ð‘–) {{_ : hasDecidableEquality âŸ¨ P âŸ©}} {{_ : âˆ€{a b : âŸ¨ P âŸ©} -> isProp (a â‰¤ b)}} where

  private variable
    U V : âŸ¨ P âŸ©

  ---------------------------------------------
  -- modes

  -- modes are "copies" of MLTT inside our type theory
  data Mode-SRN : Set where
    â–² : Mode-SRN -- the local mode
    â—¯ : Mode-SRN -- the global mode

  ---------------------------------------------
  -- mode homomorphisms (modalities)

  -- modalities are morphisms between modes,
  -- they are generated by the following two
  -- base mode homs.
  data BaseModeHom-SRN : (m n : Mode-SRN) -> ð’° (ð‘– âŒ„ 0) where
    `ï¼ ` : âˆ€(U : âŸ¨ P âŸ©) -> BaseModeHom-SRN â–² â—¯
    `[]` : BaseModeHom-SRN â—¯ â–²

  ---------------------------------------------
  -- mode transformations

  data BaseModeTrans-SRN : Visibility -> {m n : Mode-SRN} (Î¼s Î·s : Path BaseModeHom-SRN m n) -> ð’° ð‘– where
    send : âˆ€ U -> BaseModeTrans-SRN vis id (`ï¼ ` U â¨¾ `[]` â¨¾ id)
    recv : âˆ€ U -> BaseModeTrans-SRN vis (`[]` â¨¾ `ï¼ ` U â¨¾ id) id
    narrow : U â‰¤ V -> BaseModeTrans-SRN invis (`ï¼ ` U â¨¾ id) (`ï¼ ` V â¨¾ id)


  ------------------------------------------------------------------------
  -- Decidability

  decide-â‰¡-Mode-SRN : (x y : Mode-SRN) â†’ isDecidable (x â‰¡ y)
  decide-â‰¡-Mode-SRN â–² â–² = yes refl-â‰¡
  decide-â‰¡-Mode-SRN â–² â—¯ = no (Î» ())
  decide-â‰¡-Mode-SRN â—¯ â–² = no (Î» ())
  decide-â‰¡-Mode-SRN â—¯ â—¯ = yes refl-â‰¡

  instance
    hasDecidableEquality:Mode-SRN : hasDecidableEquality Mode-SRN
    hasDecidableEquality:Mode-SRN = record { _â‰Ÿ_ = decide-â‰¡-Mode-SRN }

  decide-â‰¡-BaseModeHom-SRN : âˆ€{a b} -> (x y : BaseModeHom-SRN a b) â†’ isDecidable (x â‰¡ y)
  decide-â‰¡-BaseModeHom-SRN (`ï¼ ` U) (`ï¼ ` V) with U â‰Ÿ V
  ... | no p = no Î» {refl -> p refl}
  ... | yes refl = yes refl
  decide-â‰¡-BaseModeHom-SRN `[]` `[]` = yes refl

  instance
    hasDecidableEquality:BaseModeHom-SRN : âˆ€{a b} -> hasDecidableEquality (BaseModeHom-SRN a b)
    hasDecidableEquality:BaseModeHom-SRN = record { _â‰Ÿ_ = decide-â‰¡-BaseModeHom-SRN }

  decide-â‰¡-BaseModeTrans-SRN : âˆ€{v a b} -> {Î¼ Î· : Path BaseModeHom-SRN a b} -> (x y : BaseModeTrans-SRN v Î¼ Î·) â†’ isDecidable (x â‰¡ y)
  decide-â‰¡-BaseModeTrans-SRN (send U) (send .U) = yes refl
  decide-â‰¡-BaseModeTrans-SRN (recv U) (recv .U) = yes refl
  decide-â‰¡-BaseModeTrans-SRN (narrow Ï•) (narrow Ïˆ) with force-â‰¡ Ï• Ïˆ
  ... | refl = yes refl

  instance
    hasDecidableEquality:BaseModeTrans-SRN : âˆ€{v a b} -> {Î¼ Î· : Path BaseModeHom-SRN a b} -> hasDecidableEquality (BaseModeTrans-SRN v Î¼ Î·)
    hasDecidableEquality:BaseModeTrans-SRN = record { _â‰Ÿ_ = decide-â‰¡-BaseModeTrans-SRN }


  SRN : 2Graph _
  SRN = record
    { Point = Mode-SRN
    ; Edge = BaseModeHom-SRN
    ; Face = BaseModeTrans-SRN
    }



